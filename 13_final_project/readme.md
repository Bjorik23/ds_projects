# Телеком — задача проекта

Оператор связи «Ниединогоразрыва.ком» хочет научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах.

## Описание услуг

Оператор предоставляет два основных типа услуг: 

1. Стационарную телефонную связь. Возможно подключение телефонного аппарата к нескольким линиям одновременно.
2. Интернет. Подключение может быть двух типов: через телефонную линию (DSL*,* от англ. *digital subscriber line*, «цифровая абонентская линия») или оптоволоконный кабель (*Fiber optic*).  

Также доступны такие услуги:

- Интернет-безопасность: антивирус (*DeviceProtection*) и блокировка небезопасных сайтов (*OnlineSecurity*);
- Выделенная линия технической поддержки (*TechSupport*);
- Облачное хранилище файлов для резервного копирования данных (*OnlineBackup*);
- Стриминговое телевидение (*StreamingTV*) и каталог фильмов (*StreamingMovies*).

За услуги клиенты могут платить каждый месяц или заключить договор на 1–2 года. Доступны различные способы расчёта и возможность получения электронного чека.

## Описание данных

Данные состоят из файлов, полученных из разных источников:

- `contract.csv` — информация о договоре;
- `personal.csv` — персональные данные клиента;
- `internet.csv` — информация об интернет-услугах;
- `phone.csv` — информация об услугах телефонии.

Во всех файлах столбец `customerID` содержит код клиента.

Информация о договорах актуальна на 1 февраля 2020.

## Данные

[final_provider.zip](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ac39c23b-718e-4cd6-bdaa-85b3a127a457/final_provider.zip)

Данные также находятся в тренажёре, в папке `/datasets/final_provider/`.

# Общие выводы по проекту

В процессе написания проекта создания модели машинного обучения для предсказания потенциального отказа клиентов от услуг компании сделано следующее:

1. Произведено изучение датасетов. По ним мы узнали, что в наличии данные о 7043 клиентах компании, из них 5517 воспользовались услугами предоставления интернета и 6361 услугами телефонной связи.
2. Произведена предобработка данных, в рамкаха которой выполнили объединение данных в один датасет, обработали пропуски, которые возникли после объединения. Также скорретировали названия столбцов, изменили типа данных в нескольких столбцах. Проверили итоговый датасет на наличие аномальных значений и дубликатов.
3. Были добавлены данные для проведения исследовательского анализа и выделен в отдельный столбец целевой признак `refusal`.
4. Проведен исследовательский анализ данных, по которому сделаны следующие наблюдения:
    - количетсво столбцов составило 23 шт., колиечство строк 7043 шт.
    - количество пропусков меньше 0,1%, что не помешает для анализа данных
    - дубликаты отсутствуют
    - в датасете присутствуют данные по 7043 клиентам
    - в датасете дангные за период регистрации с 2013-10-01 по 2020-02-01. Больше всего клиентов зарегистрировалось в 2019 году. По графику видно, что наблюдается постепенный рост спроса к 2020 году
    - 55% клиентов используют систему оплаты услуг `Month-to-month`, 24,1% предпочитают систему оплаты `Two year`, а 20,9% систему `One year`
    - 59,2% клиентов предпочитают безналичный способ оплаты
    - 33,6% клиентов используют метод оплаты `Electronic check`, 22,9% используют `Mailed check`, 21,9% используют `Bank transfer (automatic)` и 21,6% `Credit card (automatic)`
    - минимальная месячная оплата услуг составляет 18.25, а макисмальная составляет 118.75. Средняя оплата составляет 64.76, а медианное значение составляет 70.35
    - минимальная сумма общих затрат клиента на текущую дату составляет 18.8, а максимальная сумма составляет 8684.8. В среднем клиенты потратили на текущую дату 2283.30. Общий доход за рассматриваемый период составили 16 056 169
    - мужчин и женщин среди клиентов примерно поровну (50,5% против 49,5%)
    - среди клиентов только 16,2% пенсионеров
    - 48,3% клиентов состоят в браке и только у 30% клиентов есть дети на иждивении на момент заключения договоров оказания услуг
    - 78,4% клиентов пользуются услгуами предоставления интернета, из них 43,9% пользуются DSL оборудованием, а остальные подключены с применением оптоволоконного оборудования
    - из пользующихся интернет услугами:
        - 36,6% пользуются услугой блокировки небезопасных сайтов
        - 44,0% пользуются услугой облачного хранения файлов для резервного копирования данных
        - 30,9% пользуются услугой антивируса
        - 37,0% пользуются услугой выделенной линии технической поддержки
        - 49,0% пользуются услугой стриминга ТВ
        - 49,5% польузются каталогом фильмов
    - среди клиентов 90,3% пользуются услугами телефоной связи, из них 46,7% пользуются услугой многоканальной связи
    - за рассматриваемый период от услуг компании отказалось 1869 клиентов, что составляет 26,5%, что говорит о том, что каждый четвертый пользователь в последствии отказывается от предоставления услуг
    - на общие затраты клиента заметно влияет месячные траты (коэффициент корреляции - `0,63`), сильно влияет количество дней обслуживания (коэффициент корреляции - `0,88`). Умеренно влияют способ оплаты (коэффициент корреляции - `0,35`), наличие супруга (коэффициент корреляции - `0,32`), предоставление разных интернет услуг (коэффициент корреляции - от `0,35` до `0,52`)
    - на клиента умеренно влияет количество дней обслуживания (коэффициент корреляции - `0,36`), умеренно влияют тип оплаты услуг (коэффициент корреляции - `0,41`), метод оплаты (коэффициент корреляции - `0,30`), предоставление интернет-услуг (коэффициент корреляции - `0,32`)
    - необходимо скорретировать названия столбцов в соответствие с принятым стилем
    - выявлены закономерности почти всех признаков по отношению к целевому признаку
5. Произведена подготовка данных для обучения моделей, в рамках которого:
    - исследовали баланс классов, по которому выяснили, что 26% клиентов уходят из компании. Соответственно данные в целевом признаке были не сбалансированы. Чуть позже 
    - разделили данные на признаки и целевой признак и на отдельные обучающую и тестовую выборки
    - определили признаки: `type`, `paperless_billing`, `payment_method`, `senior_citizen`, `partner`, `dependents`, `internet_service`, `online_security`, `online_backup`, `device_protection`, `tech_support`, `streaming_tv`, `multiple_lines`, `monthly_charges`, `total_charges`, `days_of_service`
    - произвели порядковое кодирование признаков
    - устранили дисбаланс классов на обучающей выборке методом SMOTE
    - произвели масштабирование, т.к. для обучения использовали линейные модели
6. Обучили следующие модели с полученными метриками ROC-AUC:
    - модель логистической регрессии (ROC-AUC - 0,85)
    - модель дерева решений (ROC-AUC - 0,84)
    - модель случайного леса (ROC-AUC - 0,86)
    - модель дерева принятия решений с градиентным бустингом (ROC-AUC - 0,89)
    - модель односторонней выборки на основе градиента GOSS (ROC-AUC - 0,88)
    - модель, обученная с помощью RNN через библиотеку tensorflow (ROC-AUC - 0,82)
    - моедль градиентного бустинга CatBoost (ROC-AUC - 0,90)
    При этом стоит отметить, что для модели логистической регрессии применялась обучающая выборка после масштабирования и устранения дисбаланса классов, а во всех остальных случаях применалась обучающая выборка после кодирования

    - наибольший показатель ROC-AUC получили на модели CatBoostClassifier - 0,905. Для которой были подобраны следущие параметры:
        - 'depth': 5
        - 'l2_leaf_reg': 3 
        - 'learning_rate': 0.03
        - 'min_child_samples': 15
        - 'random_state': 27022023
7. Провели финальное тестирование, в рамках которого:
    - определили качество модели градиентного бустинга CatBoost на тестовой выборке и получилис следующие результаты:
        accuracy: 0.852
        roc_auc: 0.895
        recall: 0.597
        precision: 0.777
    - определили значимость признаков, по которому основным признаком оказалось количество дней оказания услуг для клиента. также важны тип договора, уровень месячных затрат и наличие оказания услуг доступа в интернет
    - построили матрицй ошибок, по которой доля правильных ответов составила 82,6%, при этом показатель Recall составляет - 0,87, а показатель Precision - 0,93
    
В рамках выполнения проекта выполнена основная цель, согласно которой была построена модель, которая позволит определять клиентов, которые потенциально могут отказаться от услуг, в перспективе с возможностью определения мероприятий, предложений для таких клиентов с целевой метриков ROC-AUC больше 0,85.

Все изначально намеченные пункты планы написания проекта выполнены. Основные сложности возникли при написании модели RNN на базе библиотеки Tensorflow из-за особенностей архитектуры процессора M1 PRO. Данную проблему решил путем полной переустановки Python в отдельное виртуальное окружение с применением homebrew и через miniforge.

Ключевыми шагами к решению задачи были:
- составление плана и определение цели и основных метрик качества, которые необходимо было достигнуть
- взаимодействие с тимлидом и куратором ЯП по вопросу организации выполнения задачи
- выделение в отдельный признак количества дней обслуживания
- определение и выделение отдельно целевого признака
- проведение анализа данных, по которому определили признаки для обучения моделей
- применение библиотеки CatBoost. Применяли ее впервые